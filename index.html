<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Search Engine</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        body { background: #f0f2f5; font-family: 'Segoe UI', sans-serif; }
        .main-container { max-width: 850px; margin-top: 80px; }
        .search-card { padding: 40px; border-radius: 20px; box-shadow: 0 8px 30px rgba(0,0,0,0.12); background: white; border: none; }
        .btn-custom { background-color: #0d6efd; color: white; border-radius: 10px; padding: 10px 30px; }
        #loader { display: none; }
    </style>
</head>
<body>

<div class="container main-container">
    <div class="search-card">
        <h1 class="text-center fw-bold mb-3 text-dark">Smart Search Engine</h1>
        <p class="text-center text-muted mb-5">AI-Powered Research for Students</p>
        
        <form id="query-form">
            <div class="input-group input-group-lg">
                <input type="text" class="form-control rounded-start-pill ps-4" id="query" placeholder="Ask a complex question..." required>
                <button class="btn btn-custom rounded-end-pill" type="submit">Search</button>
            </div>
        </form>

        <div class="d-flex justify-content-center mt-5">
            <div id="loader" class="spinner-border text-primary" role="status"></div>
        </div>

        <div id="result-area" class="mt-5" style="display:none;">
            <hr class="mb-4">
            <h4 class="mb-3">Results:</h4>
            <div id="answer" class="markdown-body p-3 bg-light rounded"></div>
        </div>
    </div>
    <div class="text-center mt-4 text-secondary">
        <small>Developed by Vinit Tirkey | Newcastle Application Portfolio</small>
    </div>
</div>

<script>
    const form = document.getElementById("query-form");
    const loader = document.getElementById("loader");
    const resultArea = document.getElementById("result-area");
    const answerBox = document.getElementById("answer");

    form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const query = document.getElementById("query").value.trim();
        if (!query) return;

        // UI Reset
        resultArea.style.display = "none";
        answerBox.innerHTML = "";
        loader.style.display = "block";

        try {
            const res = await fetch("/", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ query })
            });

            const data = await res.json();
            loader.style.display = "none";

            if (data.answer) {
                // Parse the Markdown (bolding, lists) into HTML
                answerBox.innerHTML = marked.parse(data.answer);
                resultArea.style.display = "block";
            } else {
                alert("Error: " + (data.error || "Unknown error"));
            }
        } catch (err) {
            loader.style.display = "none";
            alert("Network error. Make sure the backend is running.");
        }
    });
</script>
</body>
</html>